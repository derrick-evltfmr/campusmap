<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <title>UCO Campus Map Service</title>

    <!-- HTML imports -->
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300" rel="stylesheet" type="text/css">
    
    <!-- CSS style -->
    <style>
    /* ################################################## START CSS ################################################## */
        body {
          color: #404040;
          font: 400 15px/22px 'Source Sans Pro', 'Helvetica Neue', Sans-serif;
          margin: 0;
          padding: 0;
          -webkit-font-smoothing: antialiased;
          height: 100%;
          overflow: hidden;
        }
        
        * {
          -webkit-box-sizing: border-box;
          -moz-box-sizing: border-box;
          box-sizing: border-box;
        }

        h1 {
          font-size: 20px;
          margin: 0;
          margin-top: 20px;
          font-weight: 400;
          line-height: 20px;
          padding: 20px 2px;
        }
        
        s1 {
          font-size: 10px;
          font-family: 'Open Sans';
        }

        a {
          color: #404040;
          text-decoration: none;
        }

        a:hover {
          color: #101010;
        }

        #sidebar {
          width: 15%;
        }
        
        #header { 
          margin-left: 10px;
          font-family: 'Open Sans';
          font-size: 1.4em;
        }
        
        #map {
          border-left: 1px solid #fff;
          position: absolute;
          left: 15%;
          width: 65%;
          top: 0;
          bottom: 0;
        }
                                     
        #instructions {
          position: absolute;
          margin: 10px;
          width: 10%;
          top: 0;
          bottom: 0%;
          padding: 20px;
          background-color: rgba(255, 255, 255, 0.9);
          overflow-y: scroll;
          font-family: sans-serif;
          font-size: 0.8em;
          line-height: 2em;
        }

        .duration {
          font-size: 2em;
        }

        #functionfield {
          position: absolute;   /* need to have position absolute, otherwise just fix in the left side */
          left: 80%;
          margin-left: 10px;
          width: 20%;
          top: 0;
          bottom: 0;
          font-family: 'Open Sans';
          font-size: 0.8em;
        }
        
        .pad2 {                   /* add to the bar will have padding on border */
          padding: 20px;
          -webkit-box-sizing: border-box;
          -moz-box-sizing: border-box;
          box-sizing: border-box;
        }
        
        .heading {
          background: #fff;
          border-bottom: 1px solid #eee;
          height: 60px;
          line-height: 60px;
          padding: 0 10px;
        }

        .listings {
          height: 100%;
          overflow: auto;
          padding-bottom: 60px;
        }

        .listings .item {
          font-size: 11px;
          display: block;
          border-bottom: 1px solid #eee;
          padding: 10px;
          text-decoration: none;
        }

        .listings .item:last-child { border-bottom: none; }

        .listings .item .title {
          font-size: 12px;
          display: block;
          color: #527da5;
          font-weight: 700;
        }

        .listings .item .title small { 
            font-weight: 400; 
        }

        .listings .item.active .title,
        .listings .item .title:hover { color: #8cc63f; }

        .listings .item.active {
          background-color: #f8f8f8;
        }

        ::-webkit-scrollbar {
          width: 3px;
          height: 3px;
          border-left: 0;
          background: rgba(0, 0, 0, 0.1);
        }

        ::-webkit-scrollbar-track {
          background: none;
        }

        /*::-webkit-scrollbar-thumb {
          background: #00853e;
          border-radius: 0;
        }*/

        .clearfix { display: block; }

        .clearfix::after {
          content: '.';
          display: block;
          height: 0;
          clear: both;
          visibility: hidden;
        }
        
        /* Marker tweaks */
        .mapboxgl-popup-close-button {
          display: none;
        }

        .mapboxgl-popup-content {
          font: 400 15px/22px 'Source Sans Pro', 'Helvetica Neue', Sans-serif;
          padding: 0;
          width: 180px;
          line-height: 100%;  /* this will overwrite s1*/
        }

        .mapboxgl-popup-content-wrapper {
          padding: 1%;
        }

        .mapboxgl-popup-content h3 {
          background: #419bfc;
          color: #fff;
          margin: 0;
          display: block;
          padding: 15px;
          border-radius: 3px 3px 0 0;
          font-weight: 700;
          margin-top: -15px;
        }

        .mapboxgl-popup-content h4 {
          margin: 0;
          display: block;
          padding: 10px;
          font-weight: 400;
        }

        .mapboxgl-popup-content div {
          padding: 0px;
          line-height: 2%
        }

        .mapboxgl-container .leaflet-marker-icon {
          cursor: pointer;
        }

        .mapboxgl-popup-anchor-top > .mapboxgl-popup-content {
          margin-top: 15px;
        }

        .mapboxgl-popup-anchor-top > .mapboxgl-popup-tip {
          border-bottom-color: #91c949;
        }

        .popupbutton {
          margin-left: 30px; /*center 34px */
          background-color: whitesmoke; /* light gray */
          border: none;
          color: #474746;
          padding: 4px 12px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          font-size: 12px;
          border-radius: 10px;
          -webkit-transition-duration: 0.4s; /* Safari */
          transition-duration: 0.4s;
          border: 1.5px solid #474746;
          white-space: nowrap;
        }
        .popupbutton:hover {
          margin-left: 0px;
          background-color: #999997; /* light gray */
          border: none;
          color: white;
          padding: 12px 29px;
          text-align: center;
          text-decoration: none;
          display: inline-block;
          font-size: 15px;
          border-radius: 12px;
          -webkit-transition-duration: 0.4s; /* Safari */
          transition-duration: 0.4s;
          border: 2px solid #474746;
        }

        /** { box-sizing: border-box; }*/
        /*body {
          font: 16px Arial; 
        }*/
        .autocomplete {
          /*the container must be positioned relative:*/
          position: relative;
          display: inline-block;
        }
        input {
          border: 1px solid transparent;
          background-color: #ffffff;
          padding: 10px;
          font-size: 16px;
        }
        input[type=text] {
          background-color: #ffffff;
          width: 100%;
        }
        input[type=submit] {
          background-color: DodgerBlue;
          color: #fff;
        }
        .autocomplete-items {
          position: absolute;
          border: 1px solid #d4d4d4;
          border-bottom: none;
          border-top: none;
          z-index: 99;
          /*position the autocomplete items to be the same width as the container:*/
          top: 100%;
          left: 0;
          right: 0;
        }
        .autocomplete-items div {
          padding: 10px;
          cursor: pointer;
          background-color: #fff; 
          border-bottom: 1px solid #d4d4d4; 
        }
        .autocomplete-items div:hover {
          /*when hovering an item:*/
          background-color: #e9e9e9; 
        }
        .autocomplete-active {
          /*when navigating through the items using the arrow keys:*/
          background-color: DodgerBlue !important; 
          color: #ffffff; 
        }
        
      /* ################################################## END CSS ################################################## */
    </style>
  </head>
  <body>

    <!-- HTML Body -->
    <div id='header'><h4>UCO Campus Map Service</h4></div>
    <img src ="https://upload.wikimedia.org/wikipedia/commons/a/a7/UCO-logo.gif" hspace= "15" width=200 height=50> <!--hspace = margin-left5px-->
    <div id='map' class='map pad2'></div>
    <div class='sidebar'>
      <div class='heading'> <!--heading is already a CSS specification-->
        <h1>Commonly used locations</h1>
      </div>
      <div id='listings' class='listings'></div>
    </div>
    <!--<div id='instructions' style="background-color: aliceblue"></div>          // comment out instruction sidebar         --> 
    <div id='functionfield' class='functionfield pad2' style="background-color:antiquewhite">
        <!--<b><h3>testing field</h3></b>--> 
        <br>
        
        <!--newly added-->
        <form autocomplete="off" action=javascript:void(0)>
          <b><h3><h>Building Name:</h></h3></b>
          <div class="autocomplete" style="width:300px;">
            <input type="text" id="SearchBuilding" placeholder="Building/Location" text=""><br><br>
          </div>
          <button onclick="searchBuilding()" >Search</button><br><br><br><br><br><br>

          <b><h>Start Point:</h></b><br>
          <div class="autocomplete" style="width:300px;">
            <input type="text" id="StartPoint" placeholder="Start Point">
          </div>
          <h></h><br><br>
          
          <b><h>End Point:</h></b><br>
          <div class="autocomplete" style="width:300px;">
            <input type="text" id="EndPoint" placeholder="End Point"><br>
          </div>
          <br><br>
          <input type='checkbox' class="WheelchairAccessible">Wheelchair Accessible<br><br>
          <button onclick="calculateRoute()">Navigate</button>

        </form>


        <!-- <b><h3><h>Building Name:</h></h3></b>
        <input text=""><br><br>
        <button>Search</button><br>
        <p></p>
        <br><br> 
    
        <b><h>Start Point:</h></b><br>
        <input type="text" id="StartPoint">
        <h></h><br>
        
        <b><h>End Point:</h></b><br>
        <input type="text" id="EndPoint"><br>
        <input type='checkbox' class="WheelchairAccessible">Wheelchair Accessible<br><br>
        <button onclick="calculateRoute()">Navigate</button>
      
          -->


        
    </div>   

    <div style="position: absolute; bottom: 5px; right:5px; background-color:antiquewhite; font-family: 'Open Sans'; font-size: 0.8em;">
        <a href="link" target="mid_col">Contact the Developers</a>
    </div>

    <!-- JavaScript Code -->
    <script> 
    // ################################################## START Javascript ##################################################
        
        // ############################## MAPBOX initialization ##############################
        // This will let you use the .remove() function later on   //for old browser compatability
        if (!('remove' in Element.prototype)) {
          Element.prototype.remove = function() {
            if (this.parentNode) {
              this.parentNode.removeChild(this);
            }
          };
        }
        
        mapboxgl.accessToken = 'pk.eyJ1IjoiZnJlbnp5ZHJrIiwiYSI6ImNqdDF5cGo3bjBqYnI0NG1qbzhnMmx0NmYifQ.K5MK4GArCk5nbQFbisJOFg';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/frenzydrk/cjuqdl7ou0kpa1fl8rbobt4r4', // my style
            center: [-97.47058579306456, 35.65558438585279], // starting position
            zoom: 12
        });
        

        // set the bounds of the map
        var bounds = [[-97.47647766407945, 35.65255693420957], [-97.46423070697964, 35.66388254641362]];
        map.setMaxBounds(bounds);

        // initialize the map canvas to interact with later
        var canvas = map.getCanvasContainer();

        // ############################## JS Variables initialization ##############################
        // an arbitrary start will always be the same
        // only the end or destination will change
        var start = [-97.47276891379411, 35.653974723160744];


        // pixels the map pans when the up or down arrow is clicked
        var deltaDistance = 100;

        // degrees the map rotates when the left or right arrow is clicked
        var deltaDegrees = 25;

        // --- for function use --- (one time using, need to use another var to store it)
        // var convertedIDGetFromFunction;
        // var coordsGetFromFunction;
        // var coords_arr_fromConverted;
        // var distanceGetFromFunction;

        // --- global-level points arr declaration ---
        var wid_arr;
        var nid_arr;
        var pid_arr;

        // --- global-level buildings arr declaration ---
        var MCS_warr; // 1. MCS
        var MCS_narr;
        var HOH_warr; // 2. HOH
        var HOH_narr;
        var NUC_warr; // 3. NUC
        var NUC_narr;
        var STEM_wnarr;// 4. STEM
        var LIB_wnarr; // 5. LIB
        var WEL_wnarr; // 6. WEL
        var VPL_wnarr; // 7. VPL

        // --- promote building arr to global level ---
        var buildings = [];

        // --- global level to store the current pop up focus feature
        var currentPopUpFocusFeature;

        // --- autoComplete Building List ---
        var buildinglist = ["Math and Computer Science Building (MCS)", "MCS",
                            "Howell Hall (HOH)", "HOH",
                            "Nigh University Center (NUC)", "NUC",
                            "STEM Building (STEM)", "STEM",
                            "Chambers Library (LIB)", "LIB",
                            "Wellness Center (Gym) (WEL)", "WEL",
                            "Visitor Parking Lot (VPL)", "VPL" ] ;
        

        autocomplete(document.getElementById("SearchBuilding"), buildinglist);
        autocomplete(document.getElementById("StartPoint"), buildinglist);
        autocomplete(document.getElementById("EndPoint"), buildinglist);
                      

        // --- visited table ---
        var visited_table = []; // 1D is ok for marking visited
        for (i=0; i<200; i++) visited_table[i] = false;

        // --- Points link data---
        //var linked_2D_table = create2DArray(200); // 200 rows, can create bigger if needed
        var linked_2D_array = create2DArray(200);

        MarkLinkedArray(1,[101]);
        MarkLinkedArray(2,[108]);
        MarkLinkedArray(3,[115]);
        MarkLinkedArray(4,[6,7,58,121]);
        MarkLinkedArray(5,[6,7,58,120]);
        MarkLinkedArray(6,[4,5,56,137]);
        MarkLinkedArray(7,[4,5,56,145]);
        MarkLinkedArray(8,[134]);
        MarkLinkedArray(9,[132]);
        MarkLinkedArray(10,[139]);
        MarkLinkedArray(11,[157,158]);
        MarkLinkedArray(12,[166]);
        MarkLinkedArray(13,[174,175]);
        MarkLinkedArray(14,[177]);

        MarkLinkedArray(51,[103]);
        MarkLinkedArray(52,[104]);
        MarkLinkedArray(53,[107,112]);
        MarkLinkedArray(54,[116]);
        MarkLinkedArray(55,[114,121]);
        MarkLinkedArray(56,[6,7,58,124]);
        MarkLinkedArray(57,[130]);
        MarkLinkedArray(58,[4,5,56,128]);

        MarkLinkedArray(101,[1,102]);
        MarkLinkedArray(102,[101,103,107]);
        MarkLinkedArray(103,[51,102,105,110]);
        MarkLinkedArray(104,[52,105]);
        MarkLinkedArray(105,[103,104,106]);
        MarkLinkedArray(106,[105,115,118,119]);
        MarkLinkedArray(107,[53,102,108]);
        MarkLinkedArray(108,[2,107,109]);
        MarkLinkedArray(109,[108,113,146]);
        MarkLinkedArray(110,[103,111]);
        MarkLinkedArray(111,[110,112]);
        MarkLinkedArray(112,[53,111]);
        MarkLinkedArray(113,[109,114]);
        MarkLinkedArray(114,[55,113,121]);
        MarkLinkedArray(115,[3,106,116,117,119]);
        MarkLinkedArray(116,[54,115]);
        MarkLinkedArray(117,[115,120]);
        MarkLinkedArray(118,[106,119,129]);
        MarkLinkedArray(119,[106,115,118,120,130]);
        MarkLinkedArray(120,[5,117,119,121]);
        MarkLinkedArray(121,[4,55,114,120,122]);
        MarkLinkedArray(122,[121,123,124]);
        MarkLinkedArray(123,[122,124,125,146,151]);
        MarkLinkedArray(124,[56,122,123,125]);
        MarkLinkedArray(125,[123,124,126]);
        MarkLinkedArray(126,[125,127]);
        MarkLinkedArray(127,[126,128]);
        MarkLinkedArray(128,[58,127,144,145]);
        MarkLinkedArray(129,[118,133]);
        MarkLinkedArray(130,[57,119,135]);
        MarkLinkedArray(131,[132,133]);
        MarkLinkedArray(132,[9,131]);
        MarkLinkedArray(133,[129,131,134]);
        MarkLinkedArray(134,[8,133,135,138]);
        MarkLinkedArray(135,[130,134,136]);
        MarkLinkedArray(136,[135,137]);
        MarkLinkedArray(137,[6,136,138,140,145]);
        MarkLinkedArray(138,[134,137,139]);
        MarkLinkedArray(139,[10,138,140]);
        MarkLinkedArray(140,[137,139,141,142]);
        MarkLinkedArray(141,[140,142,143]);
        MarkLinkedArray(142,[140,141,143,145]);
        MarkLinkedArray(143,[141,142,144]);
        MarkLinkedArray(144,[128,143,145]);
        MarkLinkedArray(145,[7,128,137,142,144]);
        MarkLinkedArray(146,[109,123,147]);
        MarkLinkedArray(147,[146,148]);
        MarkLinkedArray(148,[147,149]);
        MarkLinkedArray(149,[148,150,152]);
        MarkLinkedArray(150,[149,151,156]);
        MarkLinkedArray(151,[123,150]);
        MarkLinkedArray(152,[149,153]);
        MarkLinkedArray(153,[152,154]);
        MarkLinkedArray(154,[153,155]);
        MarkLinkedArray(155,[154,156,157,166]);
        MarkLinkedArray(156,[150,155]);
        MarkLinkedArray(157,[11,155]);
        MarkLinkedArray(158,[11,159]);
        MarkLinkedArray(159,[158,160]);
        MarkLinkedArray(160,[159,161]);
        MarkLinkedArray(161,[160,162]);
        MarkLinkedArray(162,[161,163]);
        MarkLinkedArray(163,[162,164]);
        MarkLinkedArray(164,[163,165]);
        MarkLinkedArray(165,[164,175]);
        MarkLinkedArray(166,[12,155,167]);
        MarkLinkedArray(167,[166,168]);
        MarkLinkedArray(168,[167,169]);
        MarkLinkedArray(169,[168,170]);
        MarkLinkedArray(170,[169,171]);
        MarkLinkedArray(171,[170,172]);
        MarkLinkedArray(172,[171,173]);
        MarkLinkedArray(173,[172,174]);
        MarkLinkedArray(174,[13,173]);
        MarkLinkedArray(175,[13,165,176]);
        MarkLinkedArray(176,[175,177]);
        MarkLinkedArray(177,[14,176]);
        





        // --- for testing ---
        var global_end = [-97.47141360688943, 35.654825767816476];
        var global_coords_test1;
        var global_coords_test2;
        var global_coords_test3;
        var global_count = 0;
        var global_test_start;
        var global_test_end;

        // ############################## JS Functions declarations ##############################
        function create2DArray(rows) { // rows number, cols doesn't matter
          var arr = [];
          for (i=0; i<rows; i++) {
            arr[i] = [];
          }
          return arr;
        }

        // function MarkLinkedTable(row_index, col_arr){
        //   for (i=0; i<col_arr.length; i++){
        //     linked_2D_table[row_index][col_arr[0]] = true;
        //   }
        // }

        function MarkLinkedArray(baseid_index, adjacentid_arr){
          for (i=0; i<adjacentid_arr.length; i++){
            linked_2D_array[baseid_index][i] = adjacentid_arr[i];  // e.g. MarkLinkedTable(102,[101,103,107]); linked_2D_array[102] = [101,103,107], so when we query 102, we will get array of [101,103,107]
          }
        }
        


        function easing(t) {
            return t * (2 - t);
        }
        
        function buildLocationList(data) { // function for building building locations list
          // Iterate through the list of stores
          for (i = 0; i < data.length; i++) {
            var currentFeature = data[i];
            // Shorten data.feature.properties to `prop` so we're not
            // writing this long form over and over again.
            var prop = currentFeature.properties;
            // Select the listing container in the HTML and append a div
            // with the class 'item' for each store
            var listings = document.getElementById('listings');
            var listing = listings.appendChild(document.createElement('div'));
            listing.className = 'item';
            listing.id = 'listing-' + i;

            // Create a new link with the class 'title' for each store
            // and fill it with the store address
            var link = listing.appendChild(document.createElement('a'));
            link.href = '#';
            link.className = 'title';
            link.dataPosition = i;
            link.innerHTML = prop.Name;

            // Add an event listener for the links in the sidebar listing                  // add listener for the listing link
            link.addEventListener('click', function(e) {
              // Update the currentFeature to the store associated with the clicked link
              var clickedListing = data[this.dataPosition]; // get the Listing Building 
              // 1. Fly to the point associated with the clicked link
              flyToStore(clickedListing);
              // 2. Close all other popups and display popup for clicked store
              createPopUp(clickedListing);
              // 3. Highlight listing in sidebar (and remove highlight for all other listings)
              var activeItem = document.getElementsByClassName('active');
              if (activeItem[0]) {
                activeItem[0].classList.remove('active');
              }
              this.parentNode.classList.add('active');
            });
            
            // Create a new div with the class 'details' for each store
            // and fill it with the city and phone number
            var details = listing.appendChild(document.createElement('div'));
            var locationOrientation;

            if (prop.Name == "Visitor Parking Lot"){
              locationOrientation = "located <u>south</u> of the campus";
            }
            else if (prop.Name == "Chambers Library (LIB)"){
              locationOrientation = "located <u>west</u> of the campus";
            }
            else if (prop.Name == "Wellness Center (Gym) (WEL)"){
              locationOrientation = "located <u>north west</u> of the campus";
            }
            else if (prop.Name == "Nigh University Center (NUC)"){
              locationOrientation = "located <u>south-south west</u> of the campus";
            }
            else if (prop.Name == "Howell Hall (HOH)"){
              locationOrientation = "located <u>south west</u> of the campus";
            }
            else if (prop.Name == "STEM Building (STEM)"){
              locationOrientation = "located <u>south</u> of the campus";
            }
            else if (prop.Name == "Math and Computer Science Building (MCS)"){
              locationOrientation = "located <u>south west</u> of the campus";

          }

            details.innerHTML = locationOrientation;
            // if (prop.phone) {
            //   details.innerHTML += ' · ' + prop.phoneFormatted;
            // }
          }
        }
        
        function flyToStore(currentFeature) {
          map.flyTo({
            animate:(false),
            center: currentFeature.geometry.coordinates[0][0],
            zoom: 16
          });
        }

        function createPopUp(currentFeature) {
          var popUps = document.getElementsByClassName('mapboxgl-popup');
          // Check if there is already a popup on the map and if so, remove it
          if (popUps[0]) popUps[0].remove();

          currentPopUpFocusFeature = currentFeature; // for set start / end point purpose

          var imageSrc;
          var textDescription;
          if (currentFeature.properties.Name == "Visitor Parking Lot"){
              imageSrc="https://i.imgur.com/kJh7vVx.jpg";
              textDescription = " ";
          }
          else if (currentFeature.properties.Name == "Chambers Library (LIB)"){
              imageSrc="https://sites.uco.edu/administration/facilities/uco-eg-buildings/historic-buildings/lib.jpg";
              textDescription = "<s1>•	Built 1966 <br>•	281,433 square feet<br>•	Major Addition in 1995, minor interior renovations in recent years. Renovation in 2000 and 2003 to capture usable space in the overhang area of the first floor for College of Education units<br></s1> ";
          }
          else if (currentFeature.properties.Name == "Wellness Center (Gym) (WEL)"){
              imageSrc="https://sites.uco.edu/administration/facilities/uco-eg-buildings/historic-buildings/wel.jpg";
              textDescription = "<s1>•	Built 2003 <br>•	75,310 square feet<br>•	The facility contains the student recreational facilities, the Mercy Health Clinic administrative offices for the AVP Wellness<br></s1> ";
          }
          else if (currentFeature.properties.Name == "Nigh University Center (NUC)"){
              imageSrc="https://3.bp.blogspot.com/-rvGTxUe4YYE/WlWKCQU3MiI/AAAAAAAAQrs/NdrWCuOrXck-6IF4BVzAeA1amQM__4-ZwCEwYBhgL/s640/knigh.JPG"; 
              textDescription = "<s1>•  One of the main building which features over 37,000 square feet of available space and serves different kinds of services for students', staff' and visitors' needs.   <br>•  With more than 25 meeting rooms, a Post Office, full-service print shop, Barnes and Noble Bookstore, a food court, restaurant, Starbucks and a convenience store.<br></s1> ";
          }
          else if (currentFeature.properties.Name == "Howell Hall (HOH)"){
              imageSrc="https://sites.uco.edu/administration/facilities/uco-eg-buildings/historic-buildings/hoh.jpg";
              textDescription = "<s1>•	Built 1949 <br> •	159,870 square feet <br> •	College of Mathematics and Science classrooms, labs, faculty and administrative offices. <br></s1>";
          }
          else if (currentFeature.properties.Name == "STEM Building (STEM)"){
              imageSrc="https://i.imgur.com/WwLDXRp.jpg";
              textDescription = "<s1>•	Built 2018 <br>•	57,000-square-foot building, which will include state-of-the-art research labs, new classrooms and faculty office space<br>•	this STEM teaching and research center is for chemists, biologists, mathematicians, forensic scientists, computer scientists and engineers to work side-by-side under one roof, to propel the academic development in CMS majors <br></s1> ";
          }
          else if (currentFeature.properties.Name == "Math and Computer Science Building (MCS)"){
              imageSrc="https://sites.uco.edu/administration/facilities/uco-eg-buildings/historic-buildings/mcs.jpg";
              textDescription = "<s1>•	Built 1984 <br> •	22,885 square feet <br> •	College of Math and Science classrooms and faculty offices and the University Data and IT support offices <br></s1>";

          }
            
          var popup = new mapboxgl.Popup({ closeOnClick: true }) // close on click <- last time it's false...
            .setLngLat(currentFeature.geometry.coordinates[0][0])
            .setHTML('<h3>' + currentFeature.properties.Name + '</h3>' +
              '<img src ='+ imageSrc+ ' width=180 height=150>' +
              textDescription +
              '<button class="popupbutton" onClick="setTextAtStartPoint()">Set As Start Point</button>'+ 
              '<button class="popupbutton" onClick="setTextAtEndPoint()">Set As End Point&nbsp;</button>')
            .addTo(map);
        }
        
        function setTextAtStartPoint(){
          var startpoint_text = currentPopUpFocusFeature.properties.Name;
          if (startpoint_text == "Visitor Parking Lot") startpoint_text = "Visitor Parking Lot (VPL)"; // handle the data not corresponding

          document.getElementById("StartPoint").value = startpoint_text;

        }

        function setTextAtEndPoint(){
          var endpoint_text =  currentPopUpFocusFeature.properties.Name;
          if (endpoint_text == "Visitor Parking Lot") endpoint_text = "Visitor Parking Lot (VPL)"; // handle the data not corresponding

          document.getElementById("EndPoint").value = endpoint_text;
        }

        function searchBuilding(){
          var searchbuilding_input = document.getElementById("SearchBuilding").value;
          var targetBuilding;

          switch(searchbuilding_input){ // convert the short form to completed form
            case "MCS":
              searchbuilding_input = "Math and Computer Science Building (MCS)";
              break;

            case "HOH":
              searchbuilding_input = "Howell Hall (HOH)";
              break;

            case "NUC":
              searchbuilding_input = "Nigh University Center (NUC)";
              break;

            case "STEM":
              searchbuilding_input = "STEM Building (STEM)";
              break;

            case "LIB":
              searchbuilding_input = "Chambers Library (LIB)";
              break;

            case "WEL":
              searchbuilding_input = "Wellness Center (Gym) (WEL)";
              break;

            case "VPL":
            case "Visitor Parking Lot (VPL)":
              searchbuilding_input = "Visitor Parking Lot";             // handle the data not corresponding
              break;
            
          }

          for (i=0; i<buildings.length; i++){
            if (buildings[i].properties.Name == searchbuilding_input){
              targetBuilding = buildings[i];
            }
          }

          flyToStore(targetBuilding);
          createPopUp(targetBuilding);


        }
        
        function getID(currentFeature){ // feature of wid/nid/pid => id
          var currentFeatureProp = currentFeature.properties;
          var id;

          if (currentFeatureProp.wid != null){
            id = currentFeatureProp.wid;      // w01 = 1
          }

          if (currentFeatureProp.nid != null){
            id = currentFeatureProp.nid+50;   // n01 = 51
          }

          if (currentFeatureProp.pid != null){
            id = currentFeatureProp.pid+100;  // p01 = 101
          }

          return id;
        }

        function convertID(id){ // id => feature of wid/nid/pid
          var featureOfTheID;

          if (id<=50) featureOfTheID = wid_arr[id];      //wid_arr[wid] {type = w, wid = id}
          if (id>50 && id<=100) featureOfTheID = nid_arr[id-50];      //nid_arr[nid] {type = n, nid = id-50}     // fixed (i>50) because this is not else if, will have error
          if (id>100) featureOfTheID = pid_arr[id-100];      //pid_arr[pid] {type = p, pid = id-100}

          return featureOfTheID;

        }

        function getCoordinates(id){ // id => coordinates of the feature [array type]
          var currentFeature = convertID(id);
          
          var coords;
          var coords_arr;

          coords = currentFeature.geometry.coordinates; // somehow here is no coordinates[0][0]
          //coords_arr = coords.toArray();
          coords_arr = coords; // found this is indeed an array

          return coords_arr;

        }

        // function getDistance(x1,y1,x2,y2){ //coords1.lat, coords1.lng, coords2.lat, coords2.lng   // return distance
        //   return Math.sqrt(Math.pow((x2-x1),2)-Math.pow((y2-y1),2));
        // }

        function getDistance(id1, id2){ //id1, id2  // return distance
          var id1Coords = getCoordinates(id1);
          var id2Coords = getCoordinates(id2);

          var x1 = id1Coords[0];
          var y1 = id1Coords[1];
          var x2 = id2Coords[0];
          var y2 = id2Coords[1];

          return Math.sqrt(Math.pow((x2-x1),2)+Math.pow((y2-y1),2));
        }

        function setAsStartPointEndPoint(){
          var startpoint = document.getElementById("StartPoint").value;
          var endpoint = document.getElementById("EndPoint").value;
          //var WheelchairAccessible = document.getElementByID("WheelchairAccessible").checked; // THIS DOESN'T WORK
          var WheelchairAccessible = document.querySelector('.WheelchairAccessible').checked; // THIS WORK

          var startpointFeature;
          var endpointFeature;

          var startpointisSet = false;
          var endpointisSet = false;

          global_coords_test1 = endpointFeature;
          global_coords_test2 = endpointisSet;
          global_coords_test3 = endpoint;

          // Check if endpoint is building input, assume one entrance first
          switch(endpoint){
            case 'Math and Computer Science Building (MCS)':
            case 'MCS':
              if (WheelchairAccessible == true) endpointFeature = MCS_warr[0];
              else endpointFeature = MCS_narr[0];
              endpointisSet = true;
              break;
            
            case 'Howell Hall (HOH)':
            case 'HOH':
              if (WheelchairAccessible == true) endpointFeature = HOH_warr[0];
              else endpointFeature = HOH_narr[0];
              endpointisSet = true;
              break;

            case 'Nigh University Center (NUC)':
            case 'NUC':
              if (WheelchairAccessible == true) endpointFeature = NUC_warr[0];
              else endpointFeature = NUC_narr[0];
              endpointisSet = true;
              break;
            
            case 'STEM Building (STEM)':
            case 'STEM':
              endpointFeature = STEM_wnarr[0];
              endpointisSet = true;
              break;
            
            case 'Chambers Library (LIB)':
            case 'LIB':
              endpointFeature = LIB_wnarr[0];
              endpointisSet = true;
              break;

            case 'Wellness Center (Gym) (WEL)':
            case 'WEL':
              endpointFeature = WEL_wnarr[0];
              endpointisSet = true;
              break;
            
            case 'Visitor Parking Lot (VPL)':
            case 'VPL':
              endpointFeature = VPL_wnarr[0];
              endpointisSet = true;
              break;

          }



          // if endpoint is not building input, check entrance input for endpoint
            if (endpointisSet == false){
            if (endpoint.length != 3) return; // if not 3 character  
            var endpointtype = endpoint.slice(0,1); // first character eg. w
            var endpointid = endpoint.slice(1,3); // 2nd and 3rd character eg. 01
            if (endpointtype!= 'w' && endpointtype != 'n' && endpointtype != 'p') return;  // if not 'w' 'n' 'p' 
            if (!isNaN(endpointid)==false) return; // if not number, isNaN (O) isNAN (X), !isNaN means is number, when is number == false, return

            if (endpointtype == 'w') {endpointFeature = wid_arr[parseInt(endpointid)]; endpointisSet = true;} // "01" =/= 1, so we need parseInt()
            if (endpointtype == 'n') {endpointFeature = nid_arr[parseInt(endpointid)]; endpointisSet = true;}
            if (endpointtype == 'p') {endpointFeature = pid_arr[parseInt(endpointid)]; endpointisSet = true;}
          }




          // check if the startpoint is building input, if yes, choose the best entrance
          var minStartDist = Math.pow(2,32)-1; // infinity
          var minStartPointid;

          switch(startpoint){
            case 'Math and Computer Science Building (MCS)':
            case 'MCS':
              if (WheelchairAccessible == true) {
                for (i=0; i<MCS_warr.length; i++){
                  var distStartEnd = getDistance(getID(MCS_warr[i]),getID(endpointFeature));
                  if (distStartEnd < minStartDist){
                    minStartDist = distStartEnd;
                    startpointFeature = MCS_warr[i];
                  }
                }
              }
              else {
                for (i=0; i<MCS_narr.length; i++){
                  var distStartEnd = getDistance(getID(MCS_narr[i]),getID(endpointFeature));
                  if (distStartEnd < minStartDist){
                    minStartDist = distStartEnd;
                    startpointFeature = MCS_narr[i];
                  }
                }
              }
              startpointisSet = true;
              break;
            
            case 'Howell Hall (HOH)':
            case 'HOH':
            if (WheelchairAccessible == true) {
                for (i=0; i<HOH_warr.length; i++){
                  var distStartEnd = getDistance(getID(HOH_warr[i]),getID(endpointFeature));
                  if (distStartEnd < minStartDist){
                    minStartDist = distStartEnd;
                    startpointFeature = HOH_warr[i];
                  }
                }
              }
              else {
                for (i=0; i<HOH_narr.length; i++){
                  var distStartEnd = getDistance(getID(HOH_narr[i]),getID(endpointFeature));
                  if (distStartEnd < minStartDist){
                    minStartDist = distStartEnd;
                    startpointFeature = HOH_narr[i];
                  }
                }
              }
              startpointisSet = true;
              break;

            case 'Nigh University Center (NUC)':
            case 'NUC':
            if (WheelchairAccessible == true) {
                for (i=0; i<NUC_warr.length; i++){
                  var distStartEnd = getDistance(getID(NUC_warr[i]),getID(endpointFeature));
                  if (distStartEnd < minStartDist){
                    minStartDist = distStartEnd;
                    startpointFeature = NUC_warr[i];
                  }
                }
              }
              else {
                for (i=0; i<NUC_narr.length; i++){
                  var distStartEnd = getDistance(getID(NUC_narr[i]),getID(endpointFeature));
                  if (distStartEnd < minStartDist){
                    minStartDist = distStartEnd;
                    startpointFeature = NUC_narr[i];
                  }
                }
              }
              startpointisSet = true;
              break;
            
            case 'STEM Building (STEM)':
            case 'STEM':
              for (i=0; i<STEM_wnarr.length; i++){
                var distStartEnd = getDistance(getID(STEM_wnarr[i]),getID(endpointFeature));
                if (distStartEnd < minStartDist){
                  minStartDist = distStartEnd;
                  startpointFeature = STEM_wnarr[i];
                }
              }
              startpointisSet = true;
              break;
            
            case 'Chambers Library (LIB)':
            case 'LIB':
              for (i=0; i<LIB_wnarr.length; i++){
                var distStartEnd = getDistance(getID(LIB_wnarr[i]),getID(endpointFeature));
                if (distStartEnd < minStartDist){
                  minStartDist = distStartEnd;
                  startpointFeature = LIB_wnarr[i];
                }
              }
              startpointisSet = true;
              break;

            case 'Wellness Center (Gym) (WEL)':
            case 'WEL':
              for (i=0; i<WEL_wnarr.length; i++){
                var distStartEnd = getDistance(getID(WEL_wnarr[i]),getID(endpointFeature));
                if (distStartEnd < minStartDist){
                  minStartDist = distStartEnd;
                  startpointFeature = WEL_wnarr[i];
                }
              }
              startpointisSet = true;
              break;
            
            case 'Visitor Parking Lot (VPL)':
            case 'VPL':
              startpointFeature = VPL_wnarr[0]; // only 1
              startpointisSet = true;
              break;
              
          }

          // if startpoint is not building input, check for entrance input
          if (startpointisSet == false){
            if (startpoint.length != 3) return;
            var startpointtype = startpoint.slice(0,1); // first character eg. w
            var startpointid = startpoint.slice(1,3); // 2nd and 3rd character eg. 01
            if (startpointtype!= 'w' && startpointtype != 'n' && startpointtype != 'p') return; // if not 'w' 'n' 'p'
            if (!isNaN(startpointid) == false) return; // if not number, isNaN (O), isNAN (X), !isNaN means is number, so when is number == false, return

            if (startpointtype == 'w') startpointFeature = wid_arr[parseInt(startpointid)]; //"01" =/= 1, so we need parseInt
            if (startpointtype == 'n') startpointFeature = nid_arr[parseInt(startpointid)];
            if (startpointtype == 'p') startpointFeature = pid_arr[parseInt(startpointid)]; // p not necessary, but can keep for p41, Visitor Parking Lot
          }

          
          // check if the building endpoint chose the best entrance
          var minEndDist = Math.pow(2,32)-1; // infinity
          var minEndPointid;

          switch(endpoint){
            case 'Math and Computer Science Building (MCS)':
            case 'MCS':
              if (WheelchairAccessible == true) {
                for (i=0; i<MCS_warr.length; i++){
                  var distEndStart = getDistance(getID(MCS_warr[i]),getID(startpointFeature));
                  if (distEndStart < minEndDist){
                    minEndDist = distEndStart;
                    endpointFeature = MCS_warr[i];
                  }
                }
              }
              else {
                for (i=0; i<MCS_narr.length; i++){
                  var distEndStart = getDistance(getID(MCS_narr[i]),getID(startpointFeature));
                  if (distEndStart < minEndDist){
                    minEndDist = distEndStart;
                    endpointFeature = MCS_narr[i];
                  }
                }
              }
              break;
            
            case 'Howell Hall (HOH)':
            case 'HOH':
            if (WheelchairAccessible == true) {
                for (i=0; i<HOH_warr.length; i++){
                  var distEndStart = getDistance(getID(HOH_warr[i]),getID(startpointFeature));
                  if (distEndStart < minEndDist){
                    minEndDist = distEndStart;
                    endpointFeature = HOH_warr[i];
                  }
                }
              }
              else {
                for (i=0; i<HOH_narr.length; i++){
                  var distEndStart = getDistance(getID(HOH_narr[i]),getID(startpointFeature));
                  if (distEndStart < minEndDist){
                    minEndDist = distEndStart;
                    endpointFeature = HOH_narr[i];
                  }
                }
              }              
              break;

            case 'Nigh University Center (NUC)':
            case 'NUC':
            if (WheelchairAccessible == true) {
                for (i=0; i<NUC_warr.length; i++){
                  var distEndStart = getDistance(getID(NUC_warr[i]),getID(startpointFeature));
                  if (distEndStart < minEndDist){
                    minEndDist = distEndStart;
                    endpointFeature = NUC_warr[i];
                  }
                }
              }
              else {
                for (i=0; i<NUC_narr.length; i++){
                  var distEndStart = getDistance(getID(NUC_narr[i]),getID(startpointFeature));
                  if (distEndStart < minEndDist){
                    minEndDist = distEndStart;
                    endpointFeature = NUC_narr[i];
                  }
                }
              }              
              break;
            
            case 'STEM Building (STEM)':
            case 'STEM':
              for (i=0; i<STEM_wnarr.length; i++){
                var distEndStart = getDistance(getID(STEM_wnarr[i]),getID(startpointFeature));
                if (distEndStart < minEndDist){
                  minEndDist = distEndStart;
                  endpointFeature = STEM_wnarr[i];
                }
              }
              break;
            
            case 'Chambers Library (LIB)':
            case 'LIB':
              for (i=0; i<LIB_wnarr.length; i++){
                var distEndStart = getDistance(getID(LIB_wnarr[i]),getID(startpointFeature));
                if (distEndStart < minEndDist){
                  minEndDist = distEndStart;
                  endpointFeature = LIB_wnarr[i];
                }
              }              
              break;

            case 'Wellness Center (Gym) (WEL)':
            case 'WEL':
              for (i=0; i<WEL_wnarr.length; i++){
                var distEndStart = getDistance(getID(WEL_wnarr[i]),getID(startpointFeature));
                if (distEndStart < minEndDist){
                  minEndDist = distEndStart;
                  endpointFeature = WEL_wnarr[i];
                }
              }              
              break;
            
            case 'Visitor Parking Lot (VPL)':
            case 'VPL':
              endpointFeature = VPL_wnarr[0]; // only 1
              break;
              
          }

          // startpointFeature = MCS_narr[1]; //n01
          // endpointFeature = NUC_warr[1]; //w05

          var startendpoint_arr = [startpointFeature, endpointFeature];
          return startendpoint_arr;

        }

        function pickMove(currentpoint_id, endpoint_id){ // two parameters: current point, final point (destination)
          var adjacentnodes_arr = linked_2D_array[currentpoint_id];
          var minDistToEndPoint= Math.pow(2,32)-1; // infinity
          var minDistNodeid;
          
          // for each node in adjacent nodes array
          for (i=0; i < adjacentnodes_arr.length; i++){ 
            if (visited_table[adjacentnodes_arr[i]]==false){ // visited_table[each adjacent node id] == false, if the node is unvisited

              if (adjacentnodes_arr[i]!=4 && adjacentnodes_arr[i]!=5 && adjacentnodes_arr[i]!=6 && adjacentnodes_arr[i]!=7 && adjacentnodes_arr[i]!=56 && adjacentnodes_arr[i]!=58) {// NUC exceptions (have links)
                                                                                                      
                  if (adjacentnodes_arr[i]<=100 && adjacentnodes_arr[i]!=endpoint_id) continue; // if id<=100, which means entrance, but not endpoint_id, don't go into it!!!!

              }


              if (getDistance(adjacentnodes_arr[i], endpoint_id) < minDistToEndPoint){ // if the distance between the node and endpoint is the minimum dist
                minDistToEndPoint = getDistance(adjacentnodes_arr[i], endpoint_id); // then minDist = this node dist
                minDistNodeid = adjacentnodes_arr[i]; // minDistNode = this node
              }
            }
          }

          return minDistNodeid;

        }

        function calculateRoute(){
          var startendpoint_arr = setAsStartPointEndPoint();
          var startpointFeature = startendpoint_arr[0];
          var endpointFeature = startendpoint_arr[1];

          // decalre a resultroute arr;
          var resultroute_arr = [];

          // reset all visited to false before calculation
          for (i=0; i<200; i++) visited_table[i] = false; 

          // having start point and end point
          var StartPoint_ID = getID(startpointFeature);
          var EndPoint_ID = getID(endpointFeature);

          // 0th move: start point is visited
          var CurrentPoint_ID = StartPoint_ID;
          resultroute_arr[0] = CurrentPoint_ID; // start point
          visited_table[CurrentPoint_ID] = true;  // start point



          // check the whether adjacent node is visited and compare the distances between endpoint among those unvisited nodes, do these all in pickMove
          var nextMove;
          var resultroute_arr_index = 1;

          while (nextMove!=EndPoint_ID){
            nextMove = pickMove(CurrentPoint_ID, EndPoint_ID);

            CurrentPoint_ID = nextMove; // decided to move, so current point
            resultroute_arr[resultroute_arr_index] = CurrentPoint_ID; // add into result arr
            visited_table[CurrentPoint_ID] = true; // visited set to true

            global_test_start = resultroute_arr_index; // for debug testing
            global_test_end = resultroute_arr; // for debug testing
            
            if (nextMove != EndPoint_ID){ // if not arrive the end point
              resultroute_arr_index++; // resultroute arr index ++, so that to have to next index to add the next move
            }
            // if arrive the end point, it's already added to the resultroute array, then end loop
          }

          displayRoute(resultroute_arr);

        }

        function displayRoute(resultroute_arr){

          var resultcoordinates_arr = [];

          for (i=0; i<resultroute_arr.length; i++){
            resultcoordinates_arr[i] = getCoordinates(resultroute_arr[i]); // use getCoordinates to get the coordinates from id
          }

          // if the resultroute layer already exists on the map, reset it using setData
          var geojson = {
              type: 'Feature',
              properties: {},
              geometry: {
                type: 'LineString',
                coordinates: resultcoordinates_arr
              }
          }

          if (map.getSource('resultroute')) {
            map.getSource('resultroute').setData(geojson);
          }
          else {
            map.addLayer({
                "id": "resultroute",
                "type": "line",
                "source": {
                    "type": "geojson",
                    "data": {
                        "type": "Feature",
                        "properties": {},
                            "geometry": {
                                "type": "LineString",
                                "coordinates": geojson
                            }
                        }
                    },
                    "layout": {
                    "line-join": "round",
                    "line-cap": "round"
                    },
                "paint": {
                "line-color": "#617da5", // original #888, #657ba0
                "line-width": 5.5
                }
            });
          }
        }
        
        function autocomplete(inp, arr) {
          /*the autocomplete function takes two arguments,
          the text field element and an array of possible autocompleted values:*/
          var currentFocus;
          /*execute a function when someone writes in the text field:*/
          inp.addEventListener("input", function(e) {
              var a, b, i, val = this.value;
              /*close any already open lists of autocompleted values*/
              closeAllLists();
              if (!val) { return false;}
              currentFocus = -1;
              /*create a DIV element that will contain the items (values):*/
              a = document.createElement("DIV");
              a.setAttribute("id", this.id + "autocomplete-list");
              a.setAttribute("class", "autocomplete-items");
              /*append the DIV element as a child of the autocomplete container:*/
              this.parentNode.appendChild(a);
              /*for each item in the array...*/
              for (i = 0; i < arr.length; i++) {
                /*check if the item starts with the same letters as the text field value:*/
                if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                  /*create a DIV element for each matching element:*/
                  b = document.createElement("DIV");
                  /*make the matching letters bold:*/
                  b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                  b.innerHTML += arr[i].substr(val.length);
                  /*insert a input field that will hold the current array item's value:*/
                  b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                  /*execute a function when someone clicks on the item value (DIV element):*/
                      b.addEventListener("click", function(e) {
                      /*insert the value for the autocomplete text field:*/
                      inp.value = this.getElementsByTagName("input")[0].value;
                      /*close the list of autocompleted values,
                      (or any other open lists of autocompleted values:*/
                      closeAllLists();
                  });
                  a.appendChild(b);
                }
              }
            });

            /*execute a function presses a key on the keyboard:*/
            inp.addEventListener("keydown", function(e) {
                var x = document.getElementById(this.id + "autocomplete-list");
                if (x) x = x.getElementsByTagName("div");
                if (e.keyCode == 40) {
                  /*If the arrow DOWN key is pressed,
                  increase the currentFocus variable:*/
                  currentFocus++;
                  /*and and make the current item more visible:*/
                  addActive(x);
                } else if (e.keyCode == 38) { //up
                  /*If the arrow UP key is pressed,
                  decrease the currentFocus variable:*/
                  currentFocus--;
                  /*and and make the current item more visible:*/
                  addActive(x);
                } else if (e.keyCode == 13) {
                  /*If the ENTER key is pressed, prevent the form from being submitted,*/
                  e.preventDefault();
                  if (currentFocus > -1) {
                    /*and simulate a click on the "active" item:*/
                    if (x) x[currentFocus].click();
                  }
                }
            });

            function addActive(x) {
              /*a function to classify an item as "active":*/
              if (!x) return false;
              /*start by removing the "active" class on all items:*/
              removeActive(x);
              if (currentFocus >= x.length) currentFocus = 0;
              if (currentFocus < 0) currentFocus = (x.length - 1);
              /*add class "autocomplete-active":*/
              x[currentFocus].classList.add("autocomplete-active");
            }

            function removeActive(x) {
              /*a function to remove the "active" class from all autocomplete items:*/
              for (var i = 0; i < x.length; i++) {
                x[i].classList.remove("autocomplete-active");
              }
            }

            function closeAllLists(elmnt) {
              /*close all autocomplete lists in the document,
              except the one passed as an argument:*/
              var x = document.getElementsByClassName("autocomplete-items");
              for (var i = 0; i < x.length; i++) {
                if (elmnt != x[i] && elmnt != inp) {
                x[i].parentNode.removeChild(x[i]);
              }
            }
        }
        /*execute a function when someone clicks in the document:*/
        document.addEventListener("click", function (e) {
            closeAllLists(e.target);
        });
    }


        /*// this is where the code for the next step will go _Add your route request function
        // create a function to make a directions request
        function getRoute(end) {
          // make a directions request using cycling profile
          // an arbitrary start will always be the same
          // only the end or destination will change
          var start = [-97.47276891379411, 35.653974723160744];
          var url = 'https://api.mapbox.com/directions/v5/mapbox/walking/' + start[0] + ',' + start[1] + ';' + end[0] + ',' + end[1] + '?steps=true&geometries=geojson&access_token=' + mapboxgl.accessToken;

          // make an XHR request https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest
          var req = new XMLHttpRequest();
          req.responseType = 'json';
          req.open('GET', url, true);
          req.onload = function() {
            var data = req.response.routes[0];
            var route = data.geometry.coordinates;
            var geojson = {
              type: 'Feature',
              properties: {},
              geometry: {
                type: 'LineString',
                coordinates: route
              }
            };
            // if the route already exists on the map, reset it using setData
            if (map.getSource('route')) {
              map.getSource('route').setData(geojson);
            } else { // otherwise, make a new request
              map.addLayer({
                id: 'route',
                type: 'line',
                source: {
                  type: 'geojson',
                  data: {
                    type: 'Feature',
                    properties: {},
                    geometry: {
                      type: 'LineString',
                      coordinates: geojson
                    }
                  }
                },
                layout: {
                  'line-join': 'round',
                  'line-cap': 'round'
                },
                paint: {
                  'line-color': '#3887be',
                  'line-width': 5,
                  'line-opacity': 0.75
                }
              });
            }
              
          };
          req.send();
        }
        */

        // ############################## Load Event Listener: MAP INITIALIZE EVENT ##############################
        map.on('load', function() {
          map.getCanvas().focus();
          
          map.panBy([0, 350], {   //auto go down 350 manually because of UCO focus
              easing: easing
          });
          
          map.getCanvas().addEventListener('keydown', function(e) {
              e.preventDefault();
              if (e.which === 38) { // up
                  map.panBy([0, -deltaDistance], {
                  easing: easing
                  });
              } else if (e.which === 40) { // down
                  map.panBy([0, deltaDistance], {
                  easing: easing
                  });
              } else if (e.which === 37) { // left
                  map.easeTo({
                  bearing: map.getBearing() - deltaDegrees,
                  easing: easing
                  });
              } else if (e.which === 39) { // right
                  map.easeTo({
                  bearing: map.getBearing() + deltaDegrees,
                  easing: easing
                  });
              }
          }, true);

          // ############################## get buildings data from layer and load into listing (inside LOAD event) ##############################
          // Add the data to your map as a layer (GEOJSON file)
          // // don't have to add a layer... mapbox studio has it... failed to use query source... no idea about that...
          var buildings_arr = map.queryRenderedFeatures({layers: ['uco-buildings']});

          if (!buildings_arr.length) {
            return;
          }
          
          // var buildings = []; // declared in global level
          var j=0;
          var notOK = false;
          
          for (i=0; i<buildings_arr.length; i++){
              notOK = false;
              if (buildings_arr[i].properties.Name != undefined){
                  for (t=0; t<buildings.length;t++){                          // somehow it will repeat sometimes, check everytime before insert
                      if (buildings_arr[i].properties.Name == buildings[t].properties.Name){
                          notOK = true;
                          break;
                      }
                  }
                  if (notOK == false){
                      buildings[j]=buildings_arr[i];
                      j = j+1;
                  }
              }
          }
          
          buildLocationList(buildings);
          

          // ############################## get wid, nid, pid from layer and load into listing (inside LOAD event) ##############################
          var wid_arr_unsorted = map.queryRenderedFeatures({layers: ['uco-wid']});
          if (!wid_arr_unsorted.length) return;


          wid_arr = [];
          var wid_arr_count = 0;
          while (wid_arr_count < wid_arr_unsorted.length){
            for (i=0; i<wid_arr_unsorted.length; i++ ){
              var currentFeature = wid_arr_unsorted[i];
              var currentFeatureProp = currentFeature.properties;
              if (currentFeatureProp.wid == wid_arr_count+1) {
                wid_arr[wid_arr_count+1] = wid_arr_unsorted[i]; // wid_arr[1] = w01
                wid_arr_count++;
              }
            }
          }

          var nid_arr_unsorted = map.queryRenderedFeatures({layers: ['uco-nid']});
          if (!nid_arr_unsorted.length) return;

          nid_arr = [];
          var nid_arr_count = 0;
          while (nid_arr_count < nid_arr_unsorted.length){
            for (i=0; i<nid_arr_unsorted.length; i++ ){
              var currentFeature = nid_arr_unsorted[i];
              var currentFeatureProp = currentFeature.properties;
              if (currentFeatureProp.nid == nid_arr_count+1) {
                nid_arr[nid_arr_count+1] = nid_arr_unsorted[i]; // nid_arr[1] = n01
                nid_arr_count++;
              }
            }
          }
          
          var pid_arr_unsorted = map.queryRenderedFeatures({layers: ['uco-pid']});
          if (!pid_arr_unsorted.length) return;

          pid_arr = [];
          var pid_arr_count = 0;
          while (pid_arr_count < pid_arr_unsorted.length){
            for (i=0; i<pid_arr_unsorted.length; i++ ){
              var currentFeature = pid_arr_unsorted[i];
              var currentFeatureProp = currentFeature.properties;
              if (currentFeatureProp.pid == pid_arr_count+1) {
                pid_arr[pid_arr_count+1] = pid_arr_unsorted[i]; // pid_arr[1] = p01
                pid_arr_count++;
              }
            }
          }

          // global_coords_test1 = wid_arr;
          // global_coords_test2 = nid_arr;
          // global_coords_test3 = pid_arr;

          // ------------------------------ get building entrances arrays -----------------------------------
          // ### Buildings 1. MCS, 2. HOH, 3. NUC, 4. STEM, 5. LIB, 6. WEL, (7. VPL)
          // 1. MCS
          MCS_warr = [wid_arr[1]];
          MCS_narr = [wid_arr[1], nid_arr[1], nid_arr[2]];
          // 2. HOH
          HOH_warr = [wid_arr[2], wid_arr[3]];
          HOH_narr = [nid_arr[5], nid_arr[3], nid_arr[4],wid_arr[2], wid_arr[3]];
          // 3. NUC
          NUC_warr = [wid_arr[7], wid_arr[4], wid_arr[5], wid_arr[6]];
          NUC_narr = [wid_arr[7], wid_arr[4], wid_arr[5], wid_arr[6], nid_arr[6], nid_arr[7], nid_arr[8]];
          // 4. STEM
          STEM_wnarr = [wid_arr[8], wid_arr[9], wid_arr[10]];
          // 5. LIB
          LIB_wnarr = [wid_arr[11], wid_arr[12]];
          // 6. WEL
          WEL_wnarr = [wid_arr[13], wid_arr[14]];
          // (7. VPL)
          VPL_wnarr = [pid_arr[41]];


            
          // ############################## getRoute(old) (inside LOAD event) ##############################
            
          // make an initial directions request that
          // starts and ends at the same location
          //getRoute(start);

          // Add starting point to the map
          // map.addLayer({
          //   id: 'point',
          //   type: 'circle',
          //   source: {
          //     type: 'geojson',
          //     data: {
          //       type: 'FeatureCollection',
          //       features: [{
          //         type: 'Feature',
          //         properties: {},
          //         geometry: {
          //           type: 'Point',
          //           coordinates: start
          //         }
          //       }
          //       ]
          //     }
          //   },
          //   paint: {
          //     'circle-radius': 4, //start point radius
          //     'circle-color': '#3887be' //start point color
          //   }
          // });



          // ############################## CLICK Event listener (inside Load event) ##############################
          // this is where the code from the next step will go _Add your origin and get your destination
          map.on('click', function(e) {
              
              var features = map.queryRenderedFeatures(e.point, {
                layers: ['uco-buildings (1)'] // replace this with the name of the layer
              });

              if (!features.length) {
                return;
              }

              var feature = features[0];

              //global_coords_test = feature.geometry.coordinates[0][0];
              
              /*var popup = new mapboxgl.Popup({ offset: [0, -15] })                      // this popup is good, but uniform to list popup
                .setLngLat(feature.geometry.coordinates[0][0])
                .setHTML('<h3>' + feature.properties.Name + '</h3><p>' + '</p>')
                .setLngLat(feature.geometry.coordinates[0][0])
                .addTo(map);
              */
              
              // 1. Fly to the point
    //          flyToStore(feature);
              // 2. Close all other popups and display popup for clicked store
              createPopUp(feature);
              // 3. Highlight listing in sidebar (and remove highlight for all other listings)
              var activeItem = document.getElementsByClassName('active');
              if (activeItem[0]) {
                activeItem[0].classList.remove('active');
              }
              // Find the index of the store.features that corresponds to the clickedPoint that fired the event listener
              var selectedFeature = feature.properties.Name;

              for (var i = 0; i < buildings.length; i++) {
                if (buildings[i].properties.Name === selectedFeature) {
                  selectedFeatureIndex = i;
                }
              }
              // Select the correct list item using the found index and add the active class
              var listing = document.getElementById('listing-' + selectedFeatureIndex);
              listing.classList.add('active');
              
              
              
              /* THIS PART IS TO GET END POINT FOR GET ROUTE
              var coordsObj = e.lngLat;
              canvas.style.cursor = '';
              var coords = Object.keys(coordsObj).map(function(key) {
                return coordsObj[key];
              });
              var end = {
                type: 'FeatureCollection',
                features: [{
                  type: 'Feature',
                  properties: {},
                  geometry: {
                    type: 'Point',
                    coordinates: coords
                  }
                }
                ]
              };
              if (map.getLayer('end')) {
                map.getSource('end').setData(end);
              } else {
                map.addLayer({
                  id: 'end',
                  type: 'circle',
                  source: {
                    type: 'geojson',
                    data: {
                      type: 'FeatureCollection',
                      features: [{
                        type: 'Feature',
                        properties: {},
                        geometry: {
                          type: 'Point',
                          coordinates: coords
                        }
                      }]
                    }
                  },
                  paint: {
                    'circle-radius': 4, //end point radius
                    'circle-color': '#f30' //end point color
                  }
            });
          }
          global_end = coords;
          getRoute(coords);
          
          */
        });
      });
    
    // ################################################## END Javascript ##################################################
    </script>

  </body>
</html>